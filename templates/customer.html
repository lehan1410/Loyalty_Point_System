<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Kh√°ch H√†ng - Mall Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .transition-all {
            transition: all 0.3s ease;
        }

        .tab-active {
            border-bottom: 3px solid #1e40af;
            color: #1e40af;
            font-weight: 600;
        }

        [data-content] {
            display: none;
        }

        [data-content].active {
            display: block;
        }

        .reward-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #1e40af;
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-overlay {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80px;
        }

        .error-message {
            color: #ef4444;
            font-style: italic;
            text-align: center;
            padding: 1rem;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            cursor: pointer;
            font-size: 1.5rem;
            color: #666;
            transition: color 0.2s ease;
        }

        .modal-close:hover {
            color: #333;
        }

        /* Styling for the redemption code section */
        .code-container {
            background-color: #f0f4ff;
            border: 1px solid #d1e0ff;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .code-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e40af;
            letter-spacing: 1px;
        }

        .copy-button {
            background: none;
            border: none;
            cursor: pointer;
            color: #1e40af;
            font-size: 1.25rem;
            padding: 0.25rem;
            transition: color 0.2s ease, transform 0.1s ease;
        }

        .copy-button:hover {
            color: #1e3a8a;
            transform: scale(1.1);
        }

        .copy-message {
            font-size: 0.875rem;
            color: #10b981;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .copy-message.show {
            opacity: 1;
        }

        /* Styling for other sections */
        .modal-content h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 0.5rem;
        }

        .modal-content p {
            margin-bottom: 0.25rem;
            color: #4b5563;
        }

        .modal-content p strong {
            font-weight: 500;
            color: #1f2937;
        }

        /* Styling for the "S·ª≠ d·ª•ng" button */
        .use-voucher-button {
            background-color: #10b981;
            color: white;
            font-size: 0.875rem;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .use-voucher-button:hover {
            background-color: #059669;
            transform: scale(1.05);
        }
    </style>
</head>

<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-store text-2xl"></i>
                <h1 class="text-xl font-bold">Customer</h1>
            </div>
            <div class="flex items-center space-x-6">
                <div class="relative group">
                    <button id="notificationBtn" class="flex items-center space-x-2">
                        <i class="fas fa-bell text-xl"></i>
                        <span
                            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                    </button>
                    <div id="notificationDropdown"
                        class="hidden absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-50">
                        <div class="p-4 border-b">
                            <h3 class="font-bold text-gray-800">Th√¥ng b√°o (3)</h3>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <a href="#" class="block px-4 py-3 hover:bg-gray-100">
                                <p class="text-sm font-medium text-gray-900">∆Øu ƒë√£i m·ªõi t·ª´ Nike</p>
                                <p class="text-xs text-gray-500">2 gi·ªù tr∆∞·ªõc</p>
                            </a>
                            <a href="#" class="block px-4 py-3 hover:bg-gray-100">
                                <p class="text-sm font-medium text-gray-900">ƒêi·ªÉm c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t</p>
                                <p class="text-xs text-gray-500">1 ng√†y tr∆∞·ªõc</p>
                            </a>
                            <a href="#" class="block px-4 py-3 hover:bg-gray-100">
                                <p class="text-sm font-medium text-gray-900">Qu√† t·∫∑ng m·ªõi ƒë√£ ƒë∆∞·ª£c th√™m v√†o</p>
                                <p class="text-xs text-gray-500">2 ng√†y tr∆∞·ªõc</p>
                            </a>
                        </div>
                        <div class="p-2 text-center bg-gray-50">
                            <a href="#" class="text-sm text-blue-600 font-medium">Xem t·∫•t c·∫£</a>
                        </div>
                    </div>
                </div>
                <div class="relative group">
                    <button id="profileBtn" class="flex items-center space-x-2">
                        <span class="font-medium" id="customer-name-header">{{user.user_name }}</span>
                    </button>
                    <div id="profileDropdown"
                        class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-50">
                        <div class="p-4 border-b">
                            <h3 class="font-bold text-gray-800" id="customer-name-dropdown"></h3>
                            <p class="text-xs text-gray-500" id="customer-tier-dropdown">{{user.membership}}</p>
                        </div>
                        <div class="py-1">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">H·ªì s∆°</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">C√†i ƒë·∫∑t</a>
                        </div>
                        <div class="py-1 border-t">
                            <a href="/user/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ƒêƒÉng
                                xu·∫•t</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Customer Info & Points -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-2xl font-bold mb-2" id="customer-name">Xin ch√†o, {{user.user_name}}!</h2>
                    <p class="text-gray-600" id="customer-tier">Th√†nh vi√™n B·∫°c - ∆Øu ƒë√£i 5% tr√™n m·ªçi h√≥a ƒë∆°n</p>
                </div>
                <div class="bg-blue-50 rounded-lg p-4 flex items-center" id="points-container">
                    <div class="bg-blue-100 text-blue-600 p-3 rounded-lg mr-4">
                        <i class="fas fa-coins text-2xl"></i>
                    </div>
                    <div>
                        <p class="text-gray-500">ƒêi·ªÉm t√≠ch l≈©y</p>
                        <h3 class="text-2xl font-bold" id="total-points">ƒêang t·∫£i...</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="flex border-b mb-8">
            <button class="tab-btn px-4 py-2 font-medium text-gray-600 transition-all tab-active"
                data-target="promotions">∆Øu ƒë√£i</button>
            <button class="tab-btn px-4 py-2 font-medium text-gray-600 transition-all" data-target="points">Qu·∫£n l√Ω
                ƒëi·ªÉm</button>
            <button class="tab-btn px-4 py-2 font-medium text-gray-600 transition-all" data-target="vouchers">Voucher
                c·ªßa t√¥i</button>
            <button class="tab-btn px-4 py-2 font-medium text-gray-600 transition-all" data-target="history">L·ªãch s·ª≠
                giao d·ªãch</button>
            <button class="tab-btn px-4 py-2 font-medium text-gray-600 transition-all"
                data-target="voucher-history">L·ªãch s·ª≠ s·ª≠ d·ª•ng voucher</button>
            <button class="tab-btn px-4 py-2 font-medium text-gray-600 transition-all" data-target="ad">Qu·∫£ng
                c√°o</button>
        </div>

        <!-- Promotions Content -->
        <div data-content id="promotions" class="active">
            <h3 class="text-xl font-bold mb-6">∆Øu ƒë√£i hi·ªán c√≥</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="current-promotions">
                <div class="loading-overlay">
                    <div class="spinner"></div>
                </div>
            </div>
            <h3 class="text-xl font-bold mb-6">∆Øu ƒë√£i s·∫Øp t·ªõi</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="upcoming-promotions">
                <div class="loading-overlay">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- Points Management Content -->
        <div data-content id="points">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Points Summary -->
                <div class="bg-white rounded-xl shadow-md p-6 transition-all card-hover">
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-100 text-blue-600 p-3 rounded-lg mr-4">
                            <i class="fas fa-coins text-2xl"></i>
                        </div>
                        <div>
                            <p class="text-gray-500">ƒêi·ªÉm hi·ªán c√≥</p>
                            <h3 class="text-2xl font-bold" id="points-summary">ƒêang t·∫£i...</h3>
                        </div>
                    </div>
                    <div class="border-t pt-4">
                        <p class="text-sm text-gray-600"><span class="font-medium">T·ª∑ l·ªá quy ƒë·ªïi:</span> 100,000ƒë = 1
                            ƒëi·ªÉm</p>
                        <p class="text-sm text-gray-600"><span class="font-medium">C·∫•p ƒë·ªô:</span> <span
                                id="tier-summary">ƒêang t·∫£i...</span></p>
                    </div>
                </div>

                <!-- Earn Points -->
                <div class="bg-white rounded-xl shadow-md p-6 transition-all card-hover">
                    <h4 class="text-lg font-bold mb-4">T√≠ch ƒëi·ªÉm</h4>
                    <p class="text-gray-600 text-sm mb-4">Qu√©t m√£ QR t·∫°i c·ª≠a h√†ng ƒë·ªÉ t√≠ch ƒëi·ªÉm sau m·ªói l·∫ßn mua s·∫Øm</p>
                    <div class="flex flex-col items-center">
                        <img src="/static/transaction_qr.png" alt="QR Code" class="w-32 h-32 mb-4">
                        <p class="text-xs text-gray-500 mb-2">M√£ kh√°ch h√†ng: CUS123456</p>
                        <button
                            class="bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700 transition-all">
                            <i class="fas fa-download mr-2"></i> T·∫£i m√£ QR
                        </button>
                    </div>
                </div>

                <!-- Redeem Points -->
                <div class="bg-white rounded-xl shadow-md p-6 transition-all card-hover">
                    <h4 class="text-lg font-bold mb-4">ƒê·ªïi ƒëi·ªÉm l·∫•y qu√†</h4>
                    <p class="text-gray-600 text-sm mb-4">B·∫°n c√≥ th·ªÉ ƒë·ªïi ƒëi·ªÉm t√≠ch l≈©y ƒë·ªÉ nh·∫≠n c√°c ph·∫ßn qu√† h·∫•p d·∫´n</p>
                    <button class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-all">
                        Xem qu√† t·∫∑ng
                    </button>
                </div>
            </div>

            <!-- Reward Catalog -->
            <h3 class="text-xl font-bold mb-6">Qu√† t·∫∑ng ƒë·ªïi ƒëi·ªÉm</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="rewards-catalog">
                <div class="loading-overlay">
                    <div class="spinner"></div>
                </div>
            </div>
            <button
                class="w-full md:w-auto bg-white text-blue-600 border border-blue-600 font-medium py-2 px-6 rounded-lg hover:bg-blue-50 transition-all">
                <i class="fas fa-redo mr-2"></i> Xem th√™m qu√† t·∫∑ng
            </button>
        </div>

        <!-- Vouchers Content -->
        <div data-content id="vouchers">
            <h3 class="text-xl font-bold mb-6">Voucher c·ªßa t√¥i</h3>
            <!-- Brand Vouchers Section -->
            <div class="mb-8">
                <h4 class="text-lg font-bold mb-4">Voucher c·ªßa Brand</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="brand-vouchers-list">
                    <div class="loading-overlay">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            <!-- Mall Vouchers Section -->
            <div>
                <h4 class="text-lg font-bold mb-4">Voucher c·ªßa Mall</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="mall-vouchers-list">
                    <div class="loading-overlay">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction History Content -->
        <div data-content id="history">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <h3 class="text-xl font-bold mb-4 md:mb-0">L·ªãch s·ª≠ giao d·ªãch</h3>
                <div class="flex space-x-4 items-center mb-4">
                    <select id="transactionTypeFilter" class="border rounded-lg px-3 py-1">
                        <option value="all">T·∫•t c·∫£</option>
                        <option value="earn">T√≠ch ƒëi·ªÉm</option>
                        <option value="spend">ƒê·ªïi ƒëi·ªÉm</option>
                    </select>

                    <input type="date" id="transactionDateFilter" class="border rounded-lg px-3 py-1" />
                </div>

            </div>
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ng√†y</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    M√£ giao d·ªãch</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    C·ª≠a h√†ng</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    N·ªôi dung</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    ƒêi·ªÉm</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Tr·∫°ng th√°i</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="transaction-history">
                            <tr>
                                <td colspan="6" class="py-4 px-4 text-center">
                                    <div class="loading-overlay">
                                        <div class="spinner"></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="flex justify-between items-center">
                <p class="text-sm text-gray-600" id="transaction-count">
                    Hi·ªÉn th·ªã 0 tr√™n t·ªïng s·ªë 0 giao d·ªãch
                </p>
                <div class="flex justify-between items-center mt-4">

                    <div id="transaction-pagination" class="flex space-x-2"></div>
                </div>

            </div>
        </div>

        <div data-content id="voucher-history">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                <h3 class="text-xl font-bold mb-4 md:mb-0">L·ªãch s·ª≠ s·ª≠ d·ª•ng voucher</h3>
                <div class="flex space-x-4 items-center mb-4">
                    <select id="voucherSourceFilter" class="border rounded-lg px-3 py-1">
                        <option value="all">T·∫•t c·∫£</option>
                        <option value="Brand">Brand</option>
                        <option value="Mall">Mall</option>
                    </select>

                    <input type="date" id="voucherDateFilter" class="border rounded-lg px-3 py-1" />
                </div>

            </div>
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ng√†y s·ª≠ d·ª•ng</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    M√£ voucher</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    N·ªôi dung</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Ngu·ªìn</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    ƒêi·ªÉm ƒë√£ d√πng</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Tr·∫°ng th√°i</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="voucher-history-list">
                            <tr>
                                <td colspan="6" class="py-4 px-4 text-center">
                                    <div class="loading-overlay">
                                        <div class="spinner"></div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="flex justify-between items-center mt-4">
                <p class="text-sm text-gray-600" id="voucher-history-count">
                    Hi·ªÉn th·ªã 0 tr√™n t·ªïng s·ªë 0 voucher
                </p>
                <div id="voucher-pagination" class="flex space-x-2"></div>
            </div>

        </div>

        <!-- Ad Content -->
        <div data-content id="ad">
            <h3 class="text-xl font-bold mb-6">Qu·∫£ng c√°o ƒëang c√≥</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="ad-list">
                <div class="loading-overlay">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- Voucher Details Modal -->
        <div id="voucherModal" class="modal">
            <div class="modal-content relative">
                <span class="modal-close" onclick="closeVoucherModal()">√ó</span>
                <h3 class="text-xl font-bold mb-2 border-b pb-2" id="voucherModalTitle"></h3>
                <div class="code-container">
                    <div class="flex items-center">
                        <p class="code-text"><strong>M√£ ƒë·ªïi:</strong> <span id="voucherModalCode"></span></p>
                        <button class="copy-button" onclick="copyCode()" title="Sao ch√©p m√£">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <span id="copyMessage" class="copy-message">ƒê√£ sao ch√©p!</span>
                </div>
                <div class="space-y-4">
                    <div>
                        <h4>Th√¥ng tin chi ti·∫øt</h4>
                        <p><strong>N·ªôi dung:</strong> <span id="voucherModalDescription"></span></p>
                        <p><strong>S·ªë l∆∞·ª£ng:</strong> <span id="voucherModalQuantity"></span></p>
                    </div>
                    <div>
                        <h4>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h4>
                        <p id="voucherModalInstructions"></p>
                    </div>
                    <div>
                        <h4>Th√¥ng tin ƒë·ªïi</h4>
                        <p><strong>ƒêi·ªÉm ƒë√£ d√πng:</strong> <span id="voucherModalPoints"></span> ƒëi·ªÉm</p>
                        <p><strong>Ng√†y ƒë·ªïi:</strong> <span id="voucherModalDate"></span></p>
                        <p><strong>Ngu·ªìn: </strong>Brand <span id="voucherModalSource"></span></p>
                        <p><strong>Tr·∫°ng th√°i:</strong> <span id="voucherModalStatus"></span></p>
                    </div>
                    <div>
                        <h4>Th√¥ng tin th·ªùi gian</h4>
                        <p><strong>Th·ªùi gian √°p d·ª•ng:</strong> <span id="voucherModalStartAt"></span></p>
                        <p><strong>H·∫°n s·ª≠ d·ª•ng:</strong> <span id="voucherModalEndAt"></span></p>
                        <div id="useVoucherButton" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ad Detail Modal -->
        <div id="adDetailModal" class="modal">
            <div class="modal-content relative">
                <span class="modal-close cursor-pointer" onclick="closeAdDetailModal()"><i
                        class="fas fa-times"></i></span>
                <div id="adDetailContent" class="text-center">
                    <h3 class="text-xl font-bold mb-2" id="adDetailTitle"></h3>
                    <p class="text-gray-600 mb-4" id="adDetailDescription"></p>
                    <p class="text-sm text-gray-500 mb-2"><strong>Th·ªùi gian √°p d·ª•ng:</strong> <span
                            id="adDetailStartAt"></span></p>
                    <p class="text-sm text-gray-500 mb-4"><strong>H·∫°n s·ª≠ d·ª•ng:</strong> <span id="adDetailEndAt"></span>
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="text-lg font-bold mb-4">Mall Management</h4>
                    <p class="text-gray-600 text-sm">H·ªá th·ªëng qu·∫£n l√Ω v√† t√≠ch ƒëi·ªÉm cho trung t√¢m th∆∞∆°ng m·∫°i</p>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">Li√™n h·ªá</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 text-sm hover:text-blue-600 transition-all"><i
                                    class="fas fa-map-marker-alt mr-2"></i> 123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM</a></li>
                        <li><a href="#" class="text-gray-600 text-sm hover:text-blue-600 transition-all"><i
                                    class="fas fa-phone-alt mr-2"></i> 1900 1234</a></li>
                        <li><a href="#" class="text-gray-600 text-sm hover:text-blue-600 transition-all"><i
                                    class="fas fa-envelope mr-2"></i> <span class="__cf_email__"
                                    data-cfemail="d3e0e6e3e3fce1e7d3fef2fffffef2fdfe9fef6fef5fabe">[email&#160;protected]</span></a>
                        </li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">H·ªó tr·ª£</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 text-sm hover:text-blue-600 transition-all">C√¢u h·ªèi th∆∞·ªùng
                                g·∫∑p</a></li>
                        <li><a href="#" class="text-gray-600 text-sm hover:text-blue-600 transition-all">H∆∞·ªõng d·∫´n s·ª≠
                                d·ª•ng</a></li>
                        <li><a href="#" class="text-gray-600 text-sm hover:text-blue-600 transition-all">Ch√≠nh s√°ch b·∫£o
                                m·∫≠t</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-lg font-bold mb-4">K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700 transition-all"><i
                                class="fab fa-facebook-f"></i></a>
                        <a href="#" class="bg-pink-600 text-white p-2 rounded-full hover:bg-pink-700 transition-all"><i
                                class="fab fa-instagram"></i></a>
                        <a href="#" class="bg-blue-400 text-white p-2 rounded-full hover:bg-blue-500 transition-all"><i
                                class="fab fa-twitter"></i></a>
                        <a href="#" class="bg-red-600 text-white p-2 rounded-full hover:bg-red-700 transition-all"><i
                                class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-200 mt-8 pt-8 text-center text-gray-500 text-sm">
                <p>¬© 2025 Mall Management. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            </div>
        </div>
    </footer>

    <!-- <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script> -->
    <script>
        // Configuration
        const USER_ID = 1;
        const BRAND_ID = 1;

        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u tr·ªØ danh s√°ch voucher v√† qu·∫£ng c√°o
        let brandVouchers = [];
        let mallVouchers = [];
        let ads = [];

        // Utility function to format number
        function formatNumber(number) {
            if (typeof number !== 'number' || isNaN(number)) return '0';
            return number.toLocaleString('vi-VN');
        }

        // Utility function to show messages
        function showMessage(container, message, type = 'error') {
            container.innerHTML = `<div class="${type}-message">${message}</div>`;
        }

        // Fetch and render customer info
        async function loadCustomerInfo() {
            const customerName = document.getElementById('customer-name-header').textContent;
            const customerTier = document.getElementById('customer-tier-dropdown').textContent;
            document.getElementById('customer-name').textContent = `Xin ch√†o, ${customerName}!`;
            document.getElementById('customer-tier').textContent = `${customerTier} - ∆Øu ƒë√£i 5% tr√™n m·ªçi h√≥a ƒë∆°n`;
            document.getElementById('customer-name-header').textContent = customerName;
            document.getElementById('customer-name-dropdown').textContent = customerName;
            document.getElementById('customer-tier-dropdown').textContent = customerTier;
            document.getElementById('tier-summary').textContent = customerTier;
        }

        // Fetch and render total points
        async function loadTotalPoints() {
            const pointsContainer = document.getElementById('total-points');
            const pointsSummary = document.getElementById('points-summary');
            try {
                const response = await fetch(`/point/get_points/${USER_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i ƒëi·ªÉm');
                pointsContainer.innerHTML = `${formatNumber(data[0]?.total_points)} <span class="text-lg">ƒëi·ªÉm</span>`;
                pointsSummary.innerHTML = `${formatNumber(data[0]?.total_points)} <span class="text-lg">ƒëi·ªÉm</span>`;
            } catch (error) {
                console.error('Error loading total points:', error);
                pointsContainer.innerHTML = '<span class="text-red-500">L·ªói t·∫£i</span>';
                pointsSummary.innerHTML = '<span class="text-red-500">L·ªói t·∫£i</span>';
            }
        }

        // Fetch and render promotions
        async function loadPromotions() {
            const currentContainer = document.getElementById('current-promotions');
            const upcomingContainer = document.getElementById('upcoming-promotions');
            try {
                const response = await fetch(`/campaign/campaigns?brand_id=${BRAND_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i ∆∞u ƒë√£i');

                const current = data.filter(c => c.status === 'ƒêang ho·∫°t ƒë·ªông');
                if (current.length > 0) {
                    currentContainer.innerHTML = current.map(c => `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden transition-all card-hover">
                            <img src="https://placehold.co/600x300/e0e7ff/3730a3?text=${encodeURIComponent(c.title)}" alt="${c.title}" class="w-full h-40 object-cover">
                            <div class="p-6">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="text-lg font-bold">${c.title}</h4>
                                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">ƒêang ho·∫°t ƒë·ªông</span>
                                </div>
                                <p class="text-gray-600 text-sm mb-4">${c.description}</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-500"><i class="fas fa-store-alt mr-1"></i> Brand ${BRAND_ID}</span>
                                    <button class="bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700 transition-all" onclick="redeemCampaign(${c.campaign_id}, ${c.points_required})">
                                        ƒê·ªïi ngay (${formatNumber(c.points_required)} ƒëi·ªÉm)
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    currentContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">Kh√¥ng c√≥ ∆∞u ƒë√£i hi·ªán t·∫°i.</div>';
                }

                const upcoming = data.filter(c => c.status === 'S·∫Øp b·∫Øt ƒë·∫ßu');
                if (upcoming.length > 0) {
                    upcomingContainer.innerHTML = upcoming.map(c => `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden transition-all card-hover opacity-75">
                            <img src="https://placehold.co/600x300/e0e7ff/3730a3?text=${encodeURIComponent(c.title)}" alt="${c.title}" class="w-full h-40 object-cover">
                            <div class="p-6">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="text-lg font-bold">${c.title}</h4>
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">S·∫Øp di·ªÖn ra</span>
                                </div>
                                <p class="text-gray-600 text-sm mb-4">${c.description}</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-500"><i class="fas fa-store-alt mr-1"></i> Brand ${BRAND_ID}</span>
                                    <button class="bg-gray-300 text-gray-600 text-sm px-4 py-2 rounded-lg cursor-not-allowed">
                                        S·∫Øp di·ªÖn ra
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    upcomingContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">Kh√¥ng c√≥ ∆∞u ƒë√£i s·∫Øp t·ªõi.</div>';
                }
            } catch (error) {
                console.error('Error loading promotions:', error);
                showMessage(currentContainer, `L·ªói t·∫£i ∆∞u ƒë√£i: ${error.message}`);
                showMessage(upcomingContainer, `L·ªói t·∫£i ∆∞u ƒë√£i: ${error.message}`);
            }
        }

        // Fetch and render rewards
        async function loadRewards() {
            const rewardsContainer = document.getElementById('rewards-catalog');
            try {
                const response = await fetch(`/voucher/vouchers?brand_id=${BRAND_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i qu√† t·∫∑ng');

                if (data.length > 0) {
                    rewardsContainer.innerHTML = data.map(v => `
                        <div class="bg-white rounded-xl shadow-md overflow-hidden transition-all reward-card">
                            <img src="https://placehold.co/600x400/e0e7ff/3730a3?text=${encodeURIComponent(v.title)}" alt="${v.title}" class="w-full h-48 object-cover">
                            <div class="p-6">
                                <h4 class="text-lg font-bold mb-2">${v.title}</h4>
                                <p class="text-gray-600 text-sm mb-4">${v.description}</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-blue-600 font-medium">${formatNumber(v.points_required)} ƒëi·ªÉm</span>
                                    <button class="bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700 transition-all" onclick="redeemVoucher(${v.voucher_id}, ${v.points_required}, '${v.title}')">
                                        ƒê·ªïi ngay
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    rewardsContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">Kh√¥ng c√≥ qu√† t·∫∑ng n√†o.</div>';
                }
            } catch (error) {
                console.error('Error loading rewards:', error);
                showMessage(rewardsContainer, `L·ªói t·∫£i qu√† t·∫∑ng: ${error.message}`);
            }
        }

        // Fetch and render brand vouchers
        async function loadUserBrandVouchers() {
            const vouchersContainer = document.getElementById('brand-vouchers-list');
            try {
                const response = await fetch(`/campaign/user_brand_vouchers/${USER_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i voucher');

                if (data.length > 0) {
                    // üëâ Gom nh√≥m theo redemption_code (ho·∫∑c campaign_id n·∫øu ch·∫Øc ch·∫Øn duy nh·∫•t)
                    const grouped = {};
                    data.forEach(v => {
                        const key = v.redemption_code || v.campaign_id;
                        if (!grouped[key]) {
                            grouped[key] = { ...v, quantity: 1 };
                        } else {
                            grouped[key].quantity += 1;
                        }
                    });

                    brandVouchers = Object.values(grouped);

                    vouchersContainer.innerHTML = brandVouchers.map(v => `
                <div class="voucher-card bg-white rounded-xl shadow-md overflow-hidden transition-all card-hover cursor-pointer flex items-center"
                     data-id="${v.campaign_id}" data-source="Brand">
                    <div class="p-4 flex-1">
                        <h4 class="text-md font-bold mb-1">${v.title}</h4>
                        <p class="text-sm text-gray-500 mb-1"><span class="font-medium">M√£ ƒë·ªïi:</span> ${v.redemption_code}</p>
                        <p class="text-sm text-gray-500 mb-1"><span class="font-medium">ƒêi·ªÉm ƒë√£ d√πng:</span> ${formatNumber(v.points_required)} ƒëi·ªÉm</p>
                        <p class="text-sm text-gray-500 mb-1"><span class="font-medium">S·ªë l∆∞·ª£ng:</span> ${v.quantity}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-500"><i class="fas fa-store-alt mr-1"></i> Brand ${BRAND_ID}</span>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${v.status === 'Ch∆∞a s·ª≠ d·ª•ng' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">${v.status || 'Ch∆∞a s·ª≠ d·ª•ng'}</span>
                                ${v.status === 'Ch∆∞a s·ª≠ d·ª•ng' ? `<button class="bg-green-600 text-white text-sm px-3 py-1 rounded-lg hover:bg-green-700 transition-all" onclick="useVoucher(${v.campaign_id}, 'Brand', event)">S·ª≠ d·ª•ng</button>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

                    // g·∫Øn s·ª± ki·ªán click m·ªü modal
                    document.querySelectorAll('#brand-vouchers-list .voucher-card').forEach(card => {
                        card.addEventListener('click', e => {
                            e.stopPropagation();
                            const id = parseInt(card.getAttribute('data-id'));
                            showVoucherDetails(id, 'Brand');
                        });
                    });
                } else {
                    vouchersContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">B·∫°n ch∆∞a c√≥ voucher n√†o t·ª´ Brand.</div>';
                }
            } catch (error) {
                console.error('Error loading brand vouchers:', error);
                showMessage(vouchersContainer, `L·ªói t·∫£i voucher: ${error.message}`);
            }
        }


        // Fetch and render mall vouchers
        async function loadUserMallVouchers() {
            const vouchersContainer = document.getElementById('mall-vouchers-list');
            try {
                const response = await fetch(`/voucher/user_mall_vouchers/${USER_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i voucher');

                if (data.length > 0) {
                    // üëâ Gom nh√≥m theo redemption_code ho·∫∑c voucher_id
                    const grouped = {};
                    data.forEach(v => {
                        const key = v.redemption_code || v.voucher_id;
                        if (!grouped[key]) {
                            grouped[key] = { ...v, quantity: 1 };
                        } else {
                            grouped[key].quantity += 1;
                        }
                    });

                    mallVouchers = Object.values(grouped);

                    vouchersContainer.innerHTML = mallVouchers.map(v => `
                <div class="voucher-card bg-white rounded-xl shadow-md overflow-hidden transition-all card-hover cursor-pointer flex items-center"
                     data-id="${v.voucher_id}" data-source="Mall">
                    <div class="p-4 flex-1">
                        <h4 class="text-md font-bold mb-1">${v.title}</h4>
                        <p class="text-sm text-gray-500 mb-1"><span class="font-medium">M√£ ƒë·ªïi:</span> ${v.redemption_code}</p>
                        <p class="text-sm text-gray-500 mb-1"><span class="font-medium">ƒêi·ªÉm ƒë√£ d√πng:</span> ${formatNumber(v.points_required)} ƒëi·ªÉm</p>
                        <p class="text-sm text-gray-500 mb-1"><span class="font-medium">S·ªë l∆∞·ª£ng:</span> ${v.quantity}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-sm text-gray-500"><i class="fas fa-store-alt mr-1"></i> Mall</span>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full ${v.status === 'Ch∆∞a s·ª≠ d·ª•ng' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">${v.status || 'Ch∆∞a s·ª≠ d·ª•ng'}</span>
                                ${v.status === 'Ch∆∞a s·ª≠ d·ª•ng' ? `<button class="bg-green-600 text-white text-sm px-3 py-1 rounded-lg hover:bg-green-700 transition-all" onclick="useVoucher(${v.voucher_id}, 'Mall', event)">S·ª≠ d·ª•ng</button>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

                    // g·∫Øn s·ª± ki·ªán click m·ªü modal
                    document.querySelectorAll('#mall-vouchers-list .voucher-card').forEach(card => {
                        card.addEventListener('click', e => {
                            e.stopPropagation();
                            const id = parseInt(card.getAttribute('data-id'));
                            showVoucherDetails(id, 'Mall');
                        });
                    });
                } else {
                    vouchersContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">B·∫°n ch∆∞a c√≥ voucher n√†o t·ª´ Mall.</div>';
                }
            } catch (error) {
                console.error('Error loading mall vouchers:', error);
                showMessage(vouchersContainer, `L·ªói t·∫£i voucher: ${error.message}`);
            }
        }


        // Load all user vouchers
        async function loadUserVouchers() {
            await Promise.all([
                loadUserBrandVouchers(),
                loadUserMallVouchers()
            ]);
        }

        // Show voucher details in modal
        function showVoucherDetails(id, source) {
            let voucher;
            if (source === 'Brand') {
                voucher = brandVouchers.find(v => v.campaign_id === id);
            } else if (source === 'Mall') {
                voucher = mallVouchers.find(v => v.voucher_id === id);
            }

            if (!voucher) {
                console.error(`Voucher with ID ${id} not found for source ${source}`);
                return;
            }

            document.getElementById('voucherModalTitle').textContent = voucher.title;
            document.getElementById('voucherModalDescription').textContent = voucher.description;
            document.getElementById('voucherModalCode').textContent = voucher.redemption_code;
            document.getElementById('voucherModalQuantity').textContent = voucher.quantity !== undefined ? voucher.quantity : 'N/A';
            document.getElementById('voucherModalInstructions').textContent = voucher.usage_instructions || 'Kh√¥ng c√≥ h∆∞·ªõng d·∫´n c·ª• th·ªÉ.';
            document.getElementById('voucherModalPoints').textContent = formatNumber(voucher.points_required);
            document.getElementById('voucherModalDate').textContent = new Date(voucher.redeemed_at || voucher.created_at).toLocaleString('vi-VN');
            document.getElementById('voucherModalSource').textContent = voucher.brand_id;
            document.getElementById('voucherModalStatus').textContent = voucher.status || 'Ch∆∞a s·ª≠ d·ª•ng';

            // Hi·ªÉn th·ªã th·ªùi gian √°p d·ª•ng v√† h·∫°n s·ª≠ d·ª•ng
            document.getElementById('voucherModalStartAt').textContent = voucher.start_at || 'N/A';
            document.getElementById('voucherModalEndAt').textContent = voucher.end_at || 'N/A';

            // Hi·ªÉn th·ªã n√∫t "S·ª≠ d·ª•ng" n·∫øu tr·∫°ng th√°i l√† "Ch∆∞a s·ª≠ d·ª•ng"
            const useButtonContainer = document.getElementById('useVoucherButton');
            if (voucher.status === 'Ch∆∞a s·ª≠ d·ª•ng') {
                useButtonContainer.innerHTML = `
                    <button class="use-voucher-button" onclick="useVoucher(${id}, '${source}', event)">
                        S·ª≠ d·ª•ng
                    </button>
                `;
            } else {
                useButtonContainer.innerHTML = '';
            }

            // ·∫®n th√¥ng b√°o "ƒê√£ sao ch√©p" khi m·ªü modal
            document.getElementById('copyMessage').classList.add('hidden');

            document.getElementById('voucherModal').style.display = 'flex';
        }

        // Close voucher modal
        function closeVoucherModal() {
            document.getElementById('voucherModal').style.display = 'none';
        }

        // Redeem campaign
        async function redeemCampaign(campaignId, pointsRequired) {
            try {
                const pointsResponse = await fetch(`/point/get_user_points/${USER_ID}`);
                const pointsData = await pointsResponse.json();
                if (!pointsResponse.ok) throw new Error(pointsData.error || 'L·ªói ki·ªÉm tra ƒëi·ªÉm');
                if (pointsData.total_points < pointsRequired) {
                    alert('B·∫°n kh√¥ng ƒë·ªß ƒëi·ªÉm ƒë·ªÉ ƒë·ªïi ∆∞u ƒë√£i n√†y.');
                    return;
                }

                const response = await fetch(`/campaign/campaigns/${campaignId}/redeem`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: USER_ID })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói khi ƒë·ªïi ∆∞u ƒë√£i');

                await fetch('/point/redeem_points', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: USER_ID,
                        campaign_id: campaignId,
                        points_required: pointsRequired,
                        description: `ƒê·ªïi ∆∞u ƒë√£i v·ªõi m√£ ${data.redemption_code}`,
                        redemption_code: data.redemption_code
                    })
                });

                alert(`ƒê·ªïi ∆∞u ƒë√£i th√†nh c√¥ng! M√£ ƒë·ªïi: ${data.redemption_code}`);
                loadTotalPoints();
                loadTransactionHistory();
                loadUserBrandVouchers();
            } catch (error) {
                console.error('Error redeeming campaign:', error);
                alert(`L·ªói: ${error.message}`);
            }
        }

        // Redeem voucher
        async function redeemVoucher(voucherId, pointsRequired, voucherTitle) {
            try {
                if (!USER_ID || isNaN(USER_ID)) {
                    throw new Error('USER_ID kh√¥ng h·ª£p l·ªá ho·∫∑c kh√¥ng ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a!');
                }

                const pointsResponse = await fetch(`/point/get_user_points/${USER_ID}`);
                const pointsData = await pointsResponse.json();
                if (!pointsResponse.ok) throw new Error(pointsData.error || 'L·ªói ki·ªÉm tra ƒëi·ªÉm');
                if (pointsData.total_points < pointsRequired) {
                    alert('B·∫°n kh√¥ng ƒë·ªß ƒëi·ªÉm ƒë·ªÉ ƒë·ªïi qu√† n√†y.');
                    return;
                }

                const redemptionCode = Math.random().toString(36).substring(2, 8).toUpperCase();
                const response = await fetch(`/voucher/vouchers/${voucherId}/redeem`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: USER_ID,
                        points_spent: pointsRequired,
                        redemption_code: redemptionCode
                    })
                });

                const responseText = await response.text();
                if (!response.ok) {
                    console.error('Raw response:', responseText);
                    throw new Error(`L·ªói khi ƒë·ªïi qu√†: ${responseText}`);
                }

                const data = JSON.parse(responseText);

                const redeemPointsResponse = await fetch('/point/redeem_points_by_voucher', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: USER_ID,
                        points_required: pointsRequired,
                        voucher_id: voucherId,
                        description: `ƒê·ªïi voucher "${voucherTitle}" v·ªõi m√£ ${redemptionCode}`,
                        redemption_code: redemptionCode
                    })
                });
                const redeemPointsData = await redeemPointsResponse.json();
                if (!redeemPointsResponse.ok) throw new Error(redeemPointsData.error || 'L·ªói khi tr·ª´ ƒëi·ªÉm');

                alert(`ƒê·ªïi qu√† "${voucherTitle}" th√†nh c√¥ng! M√£ ƒë·ªïi: ${redemptionCode}`);
                loadTotalPoints();
                loadTransactionHistory();
                loadUserMallVouchers();
            } catch (error) {
                console.error('Error redeeming voucher:', error);
                alert(`L·ªói: ${error.message}`);
            }
        }



        // Bi·∫øn to√†n c·ª•c
        let allTransactions = [];
        let filteredTransactions = [];
        let transactionCurrentPage = 1;
        const transactionPerPage = 5;

        // Render danh s√°ch giao d·ªãch theo trang
        function renderTransactionsPaginated(transactions) {
            const historyContainer = document.getElementById('transaction-history');
            const transactionCount = document.getElementById('transaction-count');

            const totalPages = Math.ceil(transactions.length / transactionPerPage);
            if (transactionCurrentPage > totalPages) transactionCurrentPage = totalPages || 1;

            const start = (transactionCurrentPage - 1) * transactionPerPage;
            const paginated = transactions.slice(start, start + transactionPerPage);

            if (paginated.length > 0) {
                historyContainer.innerHTML = paginated.map(t => `
            <tr>
                <td class="px-6 py-4 text-sm text-gray-500">
                    ${new Date(t.date).toLocaleString('vi-VN')}
                </td>
                <td class="px-6 py-4 text-sm font-medium text-gray-900">
                    ${t.transaction_id}
                </td>
                <td class="px-6 py-4 text-sm text-gray-900">
                    ${t.store}
                </td>
                <td class="px-6 py-4 text-sm text-gray-900">
                    ${t.description}
                </td>
                <td class="px-6 py-4 text-sm ${t.points < 0 ? 'text-red-600' : 'text-green-600'} font-medium">
                    ${t.points < 0 ? '' : '+'}${formatNumber(t.points)}
                </td>
                <td class="px-6 py-4 text-sm">
                    <span class="px-2 py-1 rounded-full bg-green-100 text-green-800">${t.status}</span>
                </td>
            </tr>
        `).join('');
            } else {
                historyContainer.innerHTML = `
            <tr>
                <td colspan="6" class="py-4 px-4 text-center text-gray-600">
                    Kh√¥ng c√≥ giao d·ªãch n√†o.
                </td>
            </tr>
        `;
            }

            transactionCount.textContent = `Hi·ªÉn th·ªã ${paginated.length} tr√™n t·ªïng s·ªë ${transactions.length} giao d·ªãch`;
            renderTransactionPagination(totalPages);
        }

        // Render pagination (Prev, s·ªë trang, Next)
        function renderTransactionPagination(totalPages) {
            const container = document.getElementById('transaction-pagination');
            let html = '';

            // Prev
            html += `
      <button ${transactionCurrentPage === 1 ? 'disabled' : ''} 
        onclick="changeTransactionPage(${transactionCurrentPage - 1})"
        class="px-3 py-1 border rounded-lg 
        ${transactionCurrentPage === 1 ? 'opacity-50 cursor-not-allowed bg-gray-200' : 'bg-white hover:bg-gray-50'}">
        <i class="fas fa-chevron-left"></i>
      </button>
    `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                html += `
          <button onclick="changeTransactionPage(${i})"
            class="px-3 py-1 border rounded-lg 
            ${i === transactionCurrentPage
                        ? 'bg-blue-600 text-white border-blue-600'
                        : 'bg-white text-gray-700 hover:bg-gray-50'}">
            ${i}
          </button>
        `;
            }

            // Next
            html += `
      <button ${transactionCurrentPage === totalPages ? 'disabled' : ''} 
        onclick="changeTransactionPage(${transactionCurrentPage + 1})"
        class="px-3 py-1 border rounded-lg 
        ${transactionCurrentPage === totalPages ? 'opacity-50 cursor-not-allowed bg-gray-200' : 'bg-white hover:bg-gray-50'}">
        <i class="fas fa-chevron-right"></i>
      </button>
    `;

            container.innerHTML = html;
        }

        // ƒê·ªïi trang
        function changeTransactionPage(page) {
            const totalPages = Math.ceil(filteredTransactions.length / transactionPerPage);
            if (page < 1 || page > totalPages) return;
            transactionCurrentPage = page;
            renderTransactionsPaginated(filteredTransactions);
        }

        // Load transaction history t·ª´ API
        async function loadTransactionHistory() {
            const historyContainer = document.getElementById('transaction-history');
            try {
                const response = await fetch(`/point/${USER_ID}/transaction_history`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i l·ªãch s·ª≠ giao d·ªãch');

                allTransactions = data.transactions || [];
                transactionCurrentPage = 1;
                filterTransactions();
            } catch (error) {
                console.error('Error loading transaction history:', error);
                historyContainer.innerHTML = `
            <tr>
                <td colspan="6" class="py-4 px-4 text-center text-red-600">
                    L·ªói t·∫£i l·ªãch s·ª≠: ${error.message}
                </td>
            </tr>
        `;
            }
        }

        // L·ªçc giao d·ªãch (c√≥ th·ªÉ m·ªü r·ªông th√™m filter theo ng√†y/lo·∫°i)
        function filterTransactions() {
            const typeFilter = document.getElementById('transactionTypeFilter').value;
            const dateFilter = document.getElementById('transactionDateFilter').value;

            filteredTransactions = allTransactions;

            // L·ªçc theo lo·∫°i giao d·ªãch
            if (typeFilter !== 'all') {
                if (typeFilter === 'earn') {
                    filteredTransactions = filteredTransactions.filter(t => t.points > 0);
                } else if (typeFilter === 'spend') {
                    filteredTransactions = filteredTransactions.filter(t => t.points < 0);
                }
            }

            // L·ªçc theo ng√†y
            if (dateFilter) {
                const selectedDate = new Date(dateFilter);
                filteredTransactions = filteredTransactions.filter(t => {
                    const transDate = new Date(t.date);
                    return transDate.toDateString() === selectedDate.toDateString();
                });
            }

            transactionCurrentPage = 1;
            renderTransactionsPaginated(filteredTransactions);
        }




        // Use voucher
        async function useVoucher(id, source, event) {
            event.stopPropagation(); // NgƒÉn ch·∫∑n m·ªü modal khi nh·∫•n n√∫t "S·ª≠ d·ª•ng"
            try {
                let endpoint;
                if (source === 'Brand') {
                    endpoint = `/campaign/campaign_redemption/${id}/use`;
                } else if (source === 'Mall') {
                    endpoint = `/voucher/voucher_redemption/${id}/use`;
                }

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: USER_ID })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói khi s·ª≠ d·ª•ng voucher');

                alert('S·ª≠ d·ª•ng voucher th√†nh c√¥ng!');
                // L√†m m·ªõi danh s√°ch voucher
                await loadUserVouchers();
                // L√†m m·ªõi modal
                showVoucherDetails(id, source);
            } catch (error) {
                console.error('Error using voucher:', error);
                alert(`L·ªói: ${error.message}`);
            }
        }

        // Copy redemption code to clipboard
        function copyCode() {
            const code = document.getElementById('voucherModalCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const copyMessage = document.getElementById('copyMessage');
                copyMessage.classList.remove('hidden');
                copyMessage.classList.add('show');
                setTimeout(() => {
                    copyMessage.classList.remove('show');
                    copyMessage.classList.add('hidden');
                }, 2000); // ·∫®n th√¥ng b√°o sau 2 gi√¢y
            }).catch(err => {
                console.error('Failed to copy code:', err);
                alert('Kh√¥ng th·ªÉ sao ch√©p m√£. Vui l√≤ng th·ª≠ l·∫°i!');
            });
        }

        // Fetch and render ads
        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u tr·ªØ tr·∫°ng th√°i qu·∫£ng c√°o ƒë√£ t·∫Øt
        let dismissedAds = JSON.parse(localStorage.getItem('dismissedAds')) || [];

        // Fetch and render ads
        async function loadAds() {
            await cleanUpDismissedAds();
            const adContainer = document.getElementById('ad-list');
            try {
                const response = await fetch(`/ad/active?brand_id=${BRAND_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i qu·∫£ng c√°o');

                ads = data;
                if (data.length > 0) {
                    // L·ªçc c√°c qu·∫£ng c√°o ch∆∞a b·ªã t·∫Øt
                    const visibleAds = ads.filter(ad => !dismissedAds.includes(ad.ad_id));
                    if (visibleAds.length > 0) {
                        adContainer.innerHTML = visibleAds.map(ad => `
                            <div class="bg-white rounded-xl shadow-md overflow-hidden transition-all card-hover cursor-pointer ad-card relative" data-id="${ad.ad_id}">
                                <img src="https://placehold.co/600x300/e0e7ff/3730a3?text=${encodeURIComponent(ad.title)}" alt="${ad.title}" class="w-full h-40 object-cover">
                                <div class="p-6">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="text-lg font-bold">${ad.title}</h4>
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">ƒêang ho·∫°t ƒë·ªông</span>
                                    </div>
                                    <p class="text-gray-600 text-sm mb-4">${ad.description}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-500"><i class="fas fa-store-alt mr-1"></i> Brand ${ad.brand_id}</span>
                                        <button class="bg-blue-600 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-700 transition-all" onclick="viewAd(${ad.ad_id}, event)">
                                            Xem chi ti·∫øt
                                        </button>
                                    </div>
                                </div>
                                <!-- N√∫t T·∫Øt b√™n ngo√†i -->
                                <button class="absolute top-2 right-2 bg-gray-200 text-gray-600 p-2 rounded-full hover:bg-gray-300 transition-all dismiss-ad-btn" onclick="dismissAd(${ad.ad_id}, event)">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `).join('');

                        // G·∫Øn s·ª± ki·ªán click cho c√°c th·∫ª qu·∫£ng c√°o
                        document.querySelectorAll('.ad-card').forEach(card => {
                            card.addEventListener('click', (e) => {
                                e.stopPropagation();
                                const adId = parseInt(card.getAttribute('data-id'));
                                showAdDetails(adId);
                            });
                        });
                    } else {
                        adContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">Kh√¥ng c√≥ qu·∫£ng c√°o n√†o ƒëang ho·∫°t ƒë·ªông.</div>';
                    }
                } else {
                    adContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">Kh√¥ng c√≥ qu·∫£ng c√°o n√†o ƒëang ho·∫°t ƒë·ªông.</div>';
                }
            } catch (error) {
                console.error('Error loading ads:', error);
                showMessage(adContainer, `L·ªói t·∫£i qu·∫£ng c√°o: ${error.message}`);
            }
        }

        // H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng nh·∫•n n√∫t "T·∫Øt" b√™n ngo√†i qu·∫£ng c√°o
        async function dismissAd(adId, event) {
            event.stopPropagation(); // NgƒÉn m·ªü modal khi nh·∫•n n√∫t "T·∫Øt"

            try {
                // Ghi l·∫°i h√†nh ƒë·ªông DISMISS
                const response = await fetch('/ad/interaction', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ad_id: adId,
                        user_id: USER_ID,
                        action: 'DISMISS'
                    })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói ghi l·∫°i h√†nh ƒë·ªông');
                console.log('Ad dismissed:', data.message);

                // ·∫®n qu·∫£ng c√°o
                const adCard = document.querySelector(`.ad-card[data-id="${adId}"]`);
                if (adCard) {
                    adCard.style.display = 'none';
                }

                // L∆∞u tr·∫°ng th√°i t·∫Øt v√†o localStorage
                if (!dismissedAds.includes(adId)) {
                    dismissedAds.push(adId);
                    localStorage.setItem('dismissedAds', JSON.stringify(dismissedAds));
                }

                // Ki·ªÉm tra n·∫øu kh√¥ng c√≤n qu·∫£ng c√°o n√†o hi·ªÉn th·ªã
                const visibleAds = document.querySelectorAll('.ad-card:not([style*="display: none"])');
                if (visibleAds.length === 0) {
                    const adContainer = document.getElementById('ad-list');
                    adContainer.innerHTML = '<div class="text-gray-600 text-center col-span-full">Kh√¥ng c√≥ qu·∫£ng c√°o n√†o ƒëang ho·∫°t ƒë·ªông.</div>';
                }
            } catch (error) {
                console.error('Error dismissing ad:', error);
                alert(`L·ªói: ${error.message}`);
            }
            alert('Qu·∫£ng c√°o ƒë√£ ƒë∆∞·ª£c t·∫Øt.');
        }

        // Hi·ªÉn th·ªã chi ti·∫øt qu·∫£ng c√°o trong modal
        async function showAdDetails(adId) {
            const ad = ads.find(ad => ad.ad_id === adId);
            if (!ad) {
                console.error(`Ad with ID ${adId} not found`);
                return;
            }

            // L∆∞u adId v√†o modal ƒë·ªÉ s·ª≠ d·ª•ng khi ƒë√≥ng
            const modalContent = document.querySelector('#adDetailModal .modal-content');
            modalContent.setAttribute('data-id', adId);

            document.getElementById('adDetailTitle').textContent = ad.title;
            document.getElementById('adDetailDescription').textContent = ad.description;
            document.getElementById('adDetailStartAt').textContent = new Date(ad.start_at).toLocaleString('vi-VN');
            document.getElementById('adDetailEndAt').textContent = new Date(ad.end_at).toLocaleString('vi-VN');

            // Th√™m n√∫t "T·∫Øt" v√†o n·ªôi dung modal
            const adDetailContent = document.getElementById('adDetailContent');
            adDetailContent.innerHTML = `
                <h3 class="text-xl font-bold mb-2" id="adDetailTitle">${ad.title}</h3>
                <p class="text-gray-600 mb-4" id="adDetailDescription">${ad.description}</p>
                <p class="text-sm text-gray-500 mb-2"><strong>Th·ªùi gian √°p d·ª•ng:</strong> <span id="adDetailStartAt">${new Date(ad.start_at).toLocaleString('vi-VN')}</span></p>
                <p class="text-sm text-gray-500 mb-4"><strong>H·∫°n s·ª≠ d·ª•ng:</strong> <span id="adDetailEndAt">${new Date(ad.end_at).toLocaleString('vi-VN')}</span></p>
            `;

            document.getElementById('adDetailModal').style.display = 'flex';

            // Ghi l·∫°i h√†nh ƒë·ªông xem qu·∫£ng c√°o
            try {
                const response = await fetch('/ad/interaction', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ad_id: adId,
                        user_id: USER_ID,
                        action: 'VIEW'
                    })
                });
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói ghi l·∫°i h√†nh ƒë·ªông');
                console.log('Ad viewed:', data.message);
            } catch (error) {
                console.error('Error recording view:', error);
            }
        }

        // ƒê√≥ng modal chi ti·∫øt qu·∫£ng c√°o (kh√¥ng ghi nh·∫≠n "DISMISS" v√† kh√¥ng ·∫©n qu·∫£ng c√°o)
        async function closeAdDetailModal() {
            // ƒê√≥ng modal m√† kh√¥ng ghi nh·∫≠n "DISMISS"
            document.getElementById('adDetailModal').style.display = 'none';
        }

        // H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng nh·∫•n n√∫t "T·∫Øt" trong modal (kh√¥ng ·∫©n qu·∫£ng c√°o, kh√¥ng ghi nh·∫≠n "DISMISS")
        function dismissAdInModal(adId, event) {
            event.stopPropagation(); // NgƒÉn ch·∫∑n c√°c s·ª± ki·ªán kh√°c

            // Kh√¥ng ·∫©n qu·∫£ng c√°o, kh√¥ng ghi nh·∫≠n "DISMISS", ch·ªâ ƒë√≥ng modal
            closeAdDetailModal();
        }

        async function cleanUpDismissedAds() {
            const response = await fetch(`/ad/active?brand_id=${BRAND_ID}`);
            const data = await response.json();
            if (!response.ok) return;

            const activeAdIds = data.map(ad => ad.ad_id);
            dismissedAds = dismissedAds.filter(adId => activeAdIds.includes(adId));
            localStorage.setItem('dismissedAds', JSON.stringify(dismissedAds));
        }

        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u tr·ªØ l·ªãch s·ª≠ voucher ƒë√£ s·ª≠ d·ª•ng
        let usedBrandVouchers = [];
        let usedMallVouchers = [];

        // Fetch danh s√°ch voucher ƒë√£ s·ª≠ d·ª•ng t·ª´ Brand
        async function loadUsedBrandVouchers() {
            try {
                const response = await fetch(`/campaign/user_brand_used_vouchers/${USER_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i l·ªãch s·ª≠ voucher t·ª´ Brand');
                usedBrandVouchers = data.map(v => ({ ...v, source: 'Brand' }));
            } catch (error) {
                console.error('Error loading used brand vouchers:', error);
                usedBrandVouchers = [];
            }
        }

        // Fetch danh s√°ch voucher ƒë√£ s·ª≠ d·ª•ng t·ª´ Mall
        async function loadUsedMallVouchers() {
            try {
                const response = await fetch(`/voucher/user_mall_used_vouchers/${USER_ID}`);
                const data = await response.json();
                if (!response.ok) throw new Error(data.error || 'L·ªói t·∫£i l·ªãch s·ª≠ voucher t·ª´ Mall');
                usedMallVouchers = data.map(v => ({ ...v, source: 'Mall' }));
            } catch (error) {
                console.error('Error loading used mall vouchers:', error);
                usedMallVouchers = [];
            }
        }

        // Load t·∫•t c·∫£ l·ªãch s·ª≠ voucher ƒë√£ s·ª≠ d·ª•ng
        // ==================== VOUCHER HISTORY WITH PAGINATION ====================

        // Bi·∫øn to√†n c·ª•c
        let allVoucherHistory = [];
        let filteredVouchers = [];
        let voucherCurrentPage = 1;
        const voucherPerPage = 5;

        // Render danh s√°ch voucher theo trang
        function renderVoucherHistoryPaginated(vouchers) {
            const historyContainer = document.getElementById('voucher-history-list');
            const countContainer = document.getElementById('voucher-history-count');

            const totalPages = Math.ceil(vouchers.length / voucherPerPage);
            if (voucherCurrentPage > totalPages) voucherCurrentPage = totalPages || 1;

            const start = (voucherCurrentPage - 1) * voucherPerPage;
            const paginated = vouchers.slice(start, start + voucherPerPage);

            if (paginated.length > 0) {
                historyContainer.innerHTML = paginated.map(v => `
            <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    ${new Date(v.used_at).toLocaleString('vi-VN')}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    ${v.redemption_code}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    ${v.title}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    ${v.source === 'Brand' ? `Brand ${v.brand_id}` : 'Mall'}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-medium">
                    -${formatNumber(v.points_required)}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                        ${v.status}
                    </span>
                </td>
            </tr>
        `).join('');
            } else {
                historyContainer.innerHTML = `
            <tr>
                <td colspan="6" class="py-4 px-4 text-center text-gray-600">
                    Kh√¥ng c√≥ voucher n√†o ƒë√£ s·ª≠ d·ª•ng.
                </td>
            </tr>
        `;
            }

            countContainer.textContent = `Hi·ªÉn th·ªã ${paginated.length} tr√™n t·ªïng s·ªë ${vouchers.length} voucher`;
            renderVoucherPagination(totalPages);
        }

        // Render pagination (Prev, page numbers, Next)
        function renderVoucherPagination(totalPages) {
            const paginationContainer = document.getElementById('voucher-pagination');
            let html = '';

            // Prev
            html += `
      <button ${voucherCurrentPage === 1 ? 'disabled' : ''}
        onclick="changeVoucherPage(${voucherCurrentPage - 1})"
        class="px-3 py-1 border rounded-lg 
        ${voucherCurrentPage === 1 ? 'opacity-50 cursor-not-allowed bg-gray-200' : 'bg-white hover:bg-gray-50'}">
        <i class="fas fa-chevron-left"></i>
      </button>
    `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                html += `
          <button onclick="changeVoucherPage(${i})"
            class="px-3 py-1 border rounded-lg 
            ${i === voucherCurrentPage
                        ? 'bg-blue-600 text-white border-blue-600'
                        : 'bg-white text-gray-700 hover:bg-gray-50'}">
            ${i}
          </button>
        `;
            }

            // Next
            html += `
      <button ${voucherCurrentPage === totalPages ? 'disabled' : ''}
        onclick="changeVoucherPage(${voucherCurrentPage + 1})"
        class="px-3 py-1 border rounded-lg 
        ${voucherCurrentPage === totalPages ? 'opacity-50 cursor-not-allowed bg-gray-200' : 'bg-white hover:bg-gray-50'}">
        <i class="fas fa-chevron-right"></i>
      </button>
    `;

            paginationContainer.innerHTML = html;
        }

        // ƒê·ªïi trang
        function changeVoucherPage(page) {
            const totalPages = Math.ceil(filteredVouchers.length / voucherPerPage);
            if (page < 1 || page > totalPages) return;
            voucherCurrentPage = page;
            renderVoucherHistoryPaginated(filteredVouchers);
        }

        function renderVoucherHistory() {
            const sourceFilter = document.getElementById('voucherSourceFilter').value;
            const dateFilter = document.getElementById('voucherDateFilter').value;

            // G·ªôp danh s√°ch Brand + Mall
            allVoucherHistory = [...usedBrandVouchers, ...usedMallVouchers];

            filteredVouchers = allVoucherHistory;

            // L·ªçc theo ngu·ªìn
            if (sourceFilter !== 'all') {
                filteredVouchers = filteredVouchers.filter(v => v.source === sourceFilter);
            }

            // L·ªçc theo ng√†y
            if (dateFilter) {
                const selectedDate = new Date(dateFilter);
                filteredVouchers = filteredVouchers.filter(v => {
                    const usedDate = new Date(v.used_at);
                    return usedDate.toDateString() === selectedDate.toDateString();
                });
            }

            voucherCurrentPage = 1;
            renderVoucherHistoryPaginated(filteredVouchers);
        }

        async function loadUsedVouchers() {
            await Promise.allSettled([
                loadUsedBrandVouchers(),
                loadUsedMallVouchers()
            ]);
            renderVoucherHistory();
        }


        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('tab-active'));
                    document.querySelectorAll('[data-content]').forEach(c => c.classList.remove('active'));
                    btn.classList.add('tab-active');
                    const target = btn.getAttribute('data-target');
                    document.getElementById(target).classList.add('active');
                });
            });

            const notificationBtn = document.getElementById('notificationBtn');
            const notificationDropdown = document.getElementById('notificationDropdown');
            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');

            notificationBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                notificationDropdown.classList.toggle('hidden');
            });

            profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown.classList.toggle('hidden');
            });

            document.addEventListener('click', () => {
                notificationDropdown.classList.add('hidden');
                profileDropdown.classList.add('hidden');
                closeVoucherModal();
                closeAdDetailModal();
            });

            notificationDropdown.addEventListener('click', (e) => e.stopPropagation());
            profileDropdown.addEventListener('click', (e) => e.stopPropagation());
            document.querySelectorAll('.modal-content').forEach(content => {
                content.addEventListener('click', (e) => e.stopPropagation());
            });

            // G·∫Øn s·ª± ki·ªán l·ªçc cho ph·∫ßn l·ªãch s·ª≠ giao d·ªãch
            document.getElementById('transactionTypeFilter').addEventListener('change', filterTransactions);
            document.getElementById('transactionDateFilter').addEventListener('change', filterTransactions);

            // G·∫Øn s·ª± ki·ªán l·ªçc cho ph·∫ßn l·ªãch s·ª≠ s·ª≠ d·ª•ng voucher
            document.getElementById('voucherSourceFilter').addEventListener('change', renderVoucherHistory);
            document.getElementById('voucherDateFilter').addEventListener('change', renderVoucherHistory);


            // G·∫Øn l·∫°i s·ª± ki·ªán click cho c√°c voucher-card n·∫øu b·ªã m·∫•t
            document.querySelectorAll('.voucher-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = card.getAttribute('data-id');
                    const source = card.getAttribute('data-source');
                    showVoucherDetails(Number(id), source);
                });
            });

            Promise.allSettled([
                loadCustomerInfo(),
                loadTotalPoints(),
                loadPromotions(),
                loadRewards(),
                loadUserVouchers(),
                loadTransactionHistory(),
                loadAds(),
                loadUsedVouchers()
            ]).then(results => {
                results.forEach((result, index) => {
                    if (result.status === 'rejected') {
                        console.error(`Load failed for task ${index}:`, result.reason);
                    }
                });
            });
        });
    </script>
</body>

</html>